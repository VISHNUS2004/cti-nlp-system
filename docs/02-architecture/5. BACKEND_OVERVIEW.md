# CTI-NLP Backend Overview

This document provides an overview of the backend system powering the CTI-NLP application, including the architecture, route design, models, and processing flow.

---

## Backend Structure

```
backend/
â”œâ”€â”€ main.py                      # FastAPI app entry point (current)
â”œâ”€â”€ app_flask_backup.py          # Legacy Flask app (backup)
â”œâ”€â”€ threat_ner.py                # Named Entity Recognition using transformers
â”œâ”€â”€ classifier.py                # Threat type classification
â”œâ”€â”€ severity_predictor.py        # Severity level prediction
â”œâ”€â”€ enhanced_analyzer.py         # Enhanced comprehensive analysis
â”œâ”€â”€ simple_enhanced_analyzer.py  # Simplified enhanced analyzer
â””â”€â”€ __init__.py                  # Package initialization
```

---

## Tech Stack

| Component    | Description                                  |
| ------------ | -------------------------------------------- |
| FastAPI      | Modern, fast web framework for building APIs |
| FastAPI-CORS | Enables cross-origin requests for frontend   |
| Transformers | Pretrained NER model via HuggingFace         |
| Scikit-learn | Classifier and severity models               |
| PostgreSQL   | Primary database for data storage            |
| Redis        | Caching layer for performance                |
| SQLAlchemy   | ORM for database operations                  |
| Joblib       | Model serialization and loading              |
| Pytest       | Testing framework                            |

---

## API Endpoints

### `GET /health`

Health check endpoint with comprehensive service status.

```json
{
  "status": "healthy",
  "timestamp": "2025-08-27T10:00:00.000Z",
  "services": {
    "database": "connected",
    "redis": "connected",
    "api": "running"
  }
}
```

### `POST /analyze`

Main threat analysis endpoint for text processing.

**Request:**

```json
{
  "text": "APT29 phishing campaign targeting government agencies"
}
```

**Response:**

```json
{
  "entities": ["APT29", "phishing", "government"],
  "classification": {
    "category": "Phishing",
    "confidence": 0.85
  },
  "severity": {
    "level": "High",
    "score": 0.82
  },
  "risk_score": 75
}
```

### `GET /dashboard`

Serves the frontend dashboard interface.

### `POST /ingest`

Bulk data ingestion from external sources.

### `GET /analytics`

Provides analytics and metrics about processed threats.

---

### `POST /analyze`

Main endpoint to analyze a given cyber threat report.

#### Input (JSON)

```json
{
  "text": "Emotet is targeting Microsoft users with phishing campaigns..."
}
```

#### ðŸ”¹ Output (JSON)

```json
{
  "original_text": "...",
  "entities": [
    { "word": "Emotet", "entity_group": "ORG" },
    { "word": "Microsoft", "entity_group": "ORG" }
  ],
  "threat_type": "Phishing",
  "severity": "High"
}
```

---

## Model Components

### 1. `extract_threat_entities(text)`

- Uses: `dslim/bert-base-NER`
- Purpose: Extract named entities (ORG, LOC, MALWARE, etc.)
- Tool: Hugging Face `pipeline("ner")`

---

### 2. `classify_threat(text)`

- Model: `LogisticRegression`
- Input: TF-IDF features of cleaned text
- Output: Threat category (e.g., Phishing, Malware, Ransomware)
- Artifacts:

  - `models/threat_classifier.pkl`
  - `models/tfidf_vectorizer.pkl`

---

### 3. `predict_severity(text)`

- Model: `RandomForestClassifier`
- Input: TF-IDF vector of threat description
- Output: Risk level (Low, Medium, High)
- Artifacts:

  - `models/severity_model.pkl`
  - `models/tfidf_vectorizer_severity.pkl`

---

## Development Tips

- Always run from the project root:

  ```bash
  set PYTHONPATH=.
  python backend/app.py
  ```

- If models are retrained, don't forget to overwrite:

  - `models/*.pkl`
  - Update any preprocessing changes in `scripts/` accordingly

---

## Related Files

- `scripts/train_threat_classifier.py`
- `scripts/train_severity_model.py`
- `requirements.txt`

---

## Maintainers

- Sanjan Acharya & Team
- 2025 Major Project @ ATME AI & ML Dept.
